import{_ as te}from"./Bxrf48Gc.js";import{_ as L}from"./BKaoRVz1.js";import{_ as ae}from"./C8PGidC5.js";import{_ as le}from"./UFDYvW95.js";import{F as oe,u as re,N as ne}from"./Drrk6M2a.js";import se from"./C8qadVIp.js";import O from"./DI1v_uut.js";import G from"./DV1AUAiQ.js";import Q from"./C2Bx1OkL.js";import{e as Y,r as J,c as N,l as h,o as f,a as i,u as e,w as s,d as S,b as l,$ as ue,a9 as ie,P as U,Y as me,s as pe,k as ce,j as fe,H as j,T as de,m as K,n as B,F as ve}from"./EKjwmu4X.js";import{g as R}from"./8G3UIhLy.js";import ye from"./DWbfJTPH.js";import"./B9gn4CE_.js";import{h as ge}from"./88yLcmfY.js";import{c as _e}from"./CPAmBVur.js";import be from"./MQ2NC8KZ.js";import I from"./CmySksWD.js";const xe={class:"flex lg:justify-center items-center gap-4 flex-wrap w-full"},we=Y({__name:"RecurringExpenseFormComponent",props:{form:{},recurringExpense:{default:null}},setup(g){const m=J(g.recurringExpense!==void 0),{repetitionCount:_,frequency:k,endDate:D,spentAt:n}=g.form,x=()=>{_.value=null,k.value=null,D.value=null,m.value=!1};return(d,a)=>{const $=L;return m.value?(f(),h(e(se),{key:1,class:"w-full"},{content:s(()=>[i("div",xe,[l($,{form:d.form,name:"repetitionCount",placeholder:"Nombre de fois",class:"max-w-26"},{default:s(()=>[l(e(O),{class:"w-full",name:"repetitionCount",fluid:""})]),_:1},8,["form"]),a[2]||(a[2]=i("p",null,"par",-1)),l($,{name:"frequency",form:d.form,placeholder:"Récurrence",class:"max-w-32"},{default:s(()=>[l(e(G),{name:"frequency",options:e(oe).options,class:"w-full","label-class":"capitalize",fluid:""},null,8,["options"])]),_:1},8,["form"]),a[3]||(a[3]=i("p",null,"jusqu'au",-1)),l($,{name:"endDate",form:d.form,placeholder:"jj/mm/yyyy",class:"max-w-34"},{default:s(()=>[l(e(Q),{name:"endDate","show-icon":"","icon-display":"input",fluid:"","min-date":e(n)?new Date(e(n).value):void 0,"date-format":"dd/mm/yy"},null,8,["min-date"])]),_:1},8,["form"])])]),footer:s(()=>[i("p",{class:"item hover w-fit mx-auto mt-12",onClick:x},a[4]||(a[4]=[i("i",{class:"pi pi-times-circle mr-2"},null,-1),S("Supprimer la récurrence ")]))]),_:1})):(f(),N("div",{key:0,class:"item hover",onClick:a[0]||(a[0]=T=>m.value=!0)},a[1]||(a[1]=[i("p",null,"Créer une récurrence",-1),i("i",{class:"pi pi-arrow-right"},null,-1)])))}}}),Ce=()=>{const{$api:g}=ue();return{getMembersByGroup:_=>g.get({url:`groupes/${_}/members`,schema:ie.array()})}},ke=()=>{const g=U(),{group_id:m}=g.params,{getMembersByGroup:_}=Ce(),{data:k}=me({queryKey:["members-by-group",m],queryFn:()=>_(m),enabled:!!m});return{members:k}},De={key:0,class:"flex justify-center p-8"},$e={class:"flex gap-4 w-full items-end"},Ee={class:"flex justify-between w-full gap-4"},he={key:2,class:"flex flex-col gap-3 w-64"},Ke=Y({__name:"ExpenseForm",setup(g){const m=U(),{group_id:_,category_id:k,expense_id:D}=m.params,{group:n}=pe(ce()),{user:x}=fe(),d=j(()=>{var r;return n.value?(r=n==null?void 0:n.value.categories)==null?void 0:r.filter(t=>t.label!=="default"):[]}),{expense:a,createExpenseMutation:$,updateExpenseMutation:T,deleteExpenseMutation:X}=re(),{members:V}=ke(),w=j(()=>{var r;return(r=V.value)==null?void 0:r.map(t=>({label:t.user.username,value:t.user.id}))}),z=r=>j(()=>{var t;return r&&((t=w.value)==null?void 0:t.filter(v=>v.value===r)[0])}),Z=()=>{D&&confirm("Es-tu sûr de vouloir supprimer la dépense ?")&&X.mutate()},M=J();de(()=>{var r,t,v,p,C;if(!(!V.value||!w.value))if(a!=null&&a.value){const o=a.value;M.value={title:o.title,amount:o.amount,spentAt:new Date(o.spentAt),author:z(o.creator.id).value,category:o.category.label!=="default"?o.category:null,frequency:((r=o.recurring)==null?void 0:r.frequency)??null,repetitionCount:((t=o.recurring)==null?void 0:t.repetitionCount)??null,endDate:((v=o.recurring)==null?void 0:v.endDate)??null,participants:((p=o.participants)==null?void 0:p.map(b=>{var c;return(c=w.value)==null?void 0:c.find(u=>u.value===b.id)}).filter(Boolean))||[]}}else M.value={title:"",amount:null,spentAt:new Date,author:x&&z(x==null?void 0:x.id).value,category:(C=d.value)==null?void 0:C.find(o=>o.id===Number(k)),frequency:null,repetitionCount:null,endDate:null,participants:[]}});const ee=r=>{var E;if(!r.valid||!n.value)return;const{title:t,amount:v,spentAt:p,author:C,category:o,frequency:b,repetitionCount:c,endDate:u,participants:q}=r.states,y={title:t.value,amount:v.value,spentAt:_e(new Date(p.value)),groupId:n.value.id,authorId:C.value.value,participants:(E=q.value)==null?void 0:E.map(A=>A.value)};o&&o.value&&(y.categoryId=Number(o.value.id)),b&&c&&u&&b.value&&c.value&&u.value?y.recurring={frequency:b.value,repetitionCount:c.value,endDate:u.value}:y.recurring=null,D&&a?T.mutate(y):$.mutate(y)},P=`/groups/${_}`;return(r,t)=>{var c;const v=te,p=L,C=ae,o=le,b=we;return f(),N(ve,null,[l(v,{label:e(a)?e(a).title:"Nouveau expense",color:(c=e(n))==null?void 0:c.color,to:e(a)?`${P}/expense/${e(D)}`:P},null,8,["label","color","to"]),!e(M)||!e(w)?(f(),N("div",De,t[1]||(t[1]=[i("p",null,"Chargement...",-1)]))):(f(),h(e(ye),{key:1,"initial-values":e(M),resolver:e(ge)(e(ne)),class:"flex flex-col items-center gap-10 lg:w-2/3 mx-auto",onSubmit:ee},{default:s(u=>{var q,y,E,A,H;return[e(d)&&e(d).length>0?(f(),h(p,{key:0,name:"category",form:u,placeholder:"Catégorie"},{default:s(()=>{var F,W;return[l(e(G),{name:"category",options:e(d),"option-label":"label",class:"w-full md:w-56","label-class":["capitalize",`text-${((W=(F=u.category)==null?void 0:F.value)==null?void 0:W.color)??"gray"}-600`]},null,8,["options","label-class"])]}),_:2},1032,["form"])):K("",!0),l(C,{name:"title",placeholder:"Nom",form:u},null,8,["form"]),i("div",$e,[l(p,{form:u,name:"amount",placeholder:"Prix"},{default:s(()=>[l(e(O),{class:"w-full",name:"amount"})]),_:2},1032,["form"]),t[2]||(t[2]=i("p",{class:"text-3xl font-black mb-1"},"€",-1))]),i("div",Ee,[l(p,{form:u,name:"author",placeholder:"Auteur"},{default:s(()=>[l(e(G),{name:"author",options:e(w),"option-label":"label","label-class":["capitalize"],class:"w-2/3"},null,8,["options"])]),_:2},1032,["form"]),l(p,{name:"spentAt",form:u,placeholder:"jj/mm/yyyy"},{default:s(()=>[l(e(Q),{name:"spentAt","show-icon":"","icon-display":"input","date-format":"dd/mm/yy"})]),_:2},1032,["form"])]),l(o,{label:"Participants",class:"w-full"},{default:s(()=>[l(e(be),{name:"participants",options:e(w),multiple:"","option-label":"label",class:"w-full",fluid:""},null,8,["options"])]),_:1}),((q=e(n))==null?void 0:q.type)==="daily"?(f(),h(b,{key:1,form:u,"recurring-expense":(y=e(a))==null?void 0:y.recurring},null,8,["form","recurring-expense"])):K("",!0),e(a)?(f(),N("div",he,[l(e(I),{class:B([e(R)({color:(E=e(n))==null?void 0:E.color})]),type:"submit"},{default:s(()=>t[3]||(t[3]=[S(" Modifier la dépense ")])),_:1,__:[3]},8,["class"]),l(e(I),{variant:"outlined",class:B(e(R)({color:(A=e(n))==null?void 0:A.color,outlined:!0})),onClick:t[0]||(t[0]=F=>Z())},{default:s(()=>t[4]||(t[4]=[S(" Supprimer la dépense ")])),_:1,__:[4]},8,["class"])])):(f(),h(e(I),{key:3,class:B(["w-64",[e(R)({color:(H=e(n))==null?void 0:H.color})]]),type:"submit"},{default:s(()=>t[5]||(t[5]=[S(" Créer la dépense ")])),_:1,__:[5]},8,["class"]))]}),_:1},8,["initial-values","resolver"]))],64)}}});export{Ke as _};
