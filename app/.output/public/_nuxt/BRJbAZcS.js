import{_ as te}from"./BXLN-2ti.js";import{_ as L}from"./Ct2Kg15V.js";import{_ as le}from"./xpL0GtKN.js";import{_ as ae}from"./BY0E9GD9.js";import{F as oe,u as ne,N as re}from"./BgF1Ijsv.js";import{d as Q,r as Z,c as M,l as N,o as d,e as i,u as e,s as se,w as s,q as F,b as a,H as J,a2 as ue,j as ie,k as me,i as pe,M as j,Z as ce,m as K,g as B,n as R,F as fe}from"./DZ2khTnM.js";import O from"./BVLwsKNB.js";import V from"./BRjEZLyQ.js";import U from"./CFd5_Piq.js";import{g as I}from"./8G3UIhLy.js";import de from"./BQuv8gv2.js";import"./D0fJx_nL.js";import{h as ve}from"./DuJv_D_N.js";import{c as ye}from"./CPAmBVur.js";import{u as ge}from"./BC-j4gIq.js";import _e from"./D_VOT489.js";const be={class:"flex lg:justify-center items-center gap-4 flex-wrap w-full"},xe=Q({__name:"RecurringExpenseFormComponent",props:{form:{},recurringExpense:{default:null}},setup(C){const m=Z(C.recurringExpense!==void 0),{repetitionCount:k,frequency:D,endDate:v,spentAt:r}=C.form,b=()=>{k.value=null,D.value=null,v.value=null,m.value=!1};return(y,l)=>{const E=L;return m.value?(d(),N(e(se),{key:1,class:"w-full"},{content:s(()=>[i("div",be,[a(E,{form:y.form,name:"repetitionCount",placeholder:"Nombre de fois",class:"max-w-26"},{default:s(()=>[a(e(O),{class:"w-full",name:"repetitionCount",fluid:""})]),_:1},8,["form"]),l[2]||(l[2]=i("p",null,"par",-1)),a(E,{name:"frequency",form:y.form,placeholder:"Récurrence",class:"max-w-32"},{default:s(()=>[a(e(V),{name:"frequency",options:e(oe).options,class:"w-full","label-class":"capitalize",fluid:""},null,8,["options"])]),_:1},8,["form"]),l[3]||(l[3]=i("p",null,"jusqu'au",-1)),a(E,{name:"endDate",form:y.form,placeholder:"jj/mm/yyyy",class:"max-w-34"},{default:s(()=>[a(e(U),{name:"endDate","show-icon":"","icon-display":"input",fluid:"","min-date":e(r)?new Date(e(r).value):void 0,"date-format":"dd/mm/yy"},null,8,["min-date"])]),_:1},8,["form"])])]),footer:s(()=>[i("p",{class:"item hover w-fit mx-auto mt-12",onClick:b},l[4]||(l[4]=[i("i",{class:"pi pi-times-circle mr-2"},null,-1),F("Supprimer la récurrence ",-1)]))]),_:1})):(d(),M("div",{key:0,class:"item hover",onClick:l[0]||(l[0]=z=>m.value=!0)},l[1]||(l[1]=[i("p",null,"Créer une récurrence",-1),i("i",{class:"pi pi-arrow-right"},null,-1)])))}}}),we=()=>{const C=J(),{group_id:m}=C.params,{getMembersByGroup:k}=ge(),{data:D}=ue({queryKey:["members-by-group",m],queryFn:()=>k(m),enabled:!!m});return{members:D}},Ce={key:0,class:"flex justify-center p-8"},ke={class:"flex gap-4 w-full items-end"},De={class:"flex justify-between w-full gap-4"},Ee={key:2,class:"flex flex-col gap-3 w-64"},He=Q({__name:"ExpenseForm",setup(C){const m=J(),{group_id:k,category_id:D,expense_id:v}=m.params;console.log(v);const{group:r}=ie(me()),{user:b}=pe(),y=j(()=>{var n;return r.value?(n=r==null?void 0:r.value.categories)==null?void 0:n.filter(t=>t.label!=="default"):[]}),{expense:l,createExpenseMutation:E,updateExpenseMutation:z,deleteExpenseMutation:X}=ne(),{members:G}=we(),x=j(()=>{var n;return(n=G.value)==null?void 0:n.map(t=>({label:t.user.username,value:t.user.id}))}),T=n=>j(()=>{var t;return n&&((t=x.value)==null?void 0:t.filter(g=>g.value===n)[0])}),Y=()=>{v&&confirm("Es-tu sûr de vouloir supprimer la dépense ?")&&X.mutate()},$=Z();ce(()=>{var n,t,g,p,w;if(!(!G.value||!x.value))if(l!=null&&l.value){const o=l.value;$.value={title:o.title,amount:o.amount,spentAt:new Date(o.spentAt),author:T(o.creator.id).value,category:o.category.label!=="default"?o.category:null,frequency:((n=o.recurring)==null?void 0:n.frequency)??null,repetitionCount:((t=o.recurring)==null?void 0:t.repetitionCount)??null,endDate:((g=o.recurring)==null?void 0:g.endDate)??null,participants:((p=o.participants)==null?void 0:p.map(_=>{var c;return(c=x.value)==null?void 0:c.find(u=>u.value===_.id)}).filter(Boolean))||[]}}else $.value={title:"",amount:null,spentAt:new Date,author:b&&T(b==null?void 0:b.id).value,category:(w=y.value)==null?void 0:w.find(o=>o.id===Number(D)),frequency:null,repetitionCount:null,endDate:null,participants:[]}});const ee=n=>{var q;if(!n.valid||!r.value)return;const{title:t,amount:g,spentAt:p,author:w,category:o,frequency:_,repetitionCount:c,endDate:u,participants:h}=n.states,f={title:t.value,amount:g.value,spentAt:ye(new Date(p.value)),groupId:r.value.id,authorId:w.value.value,participants:(q=h.value)==null?void 0:q.map(A=>A.value)};v&&(f.id=Number(v)),o&&o.value&&(f.categoryId=Number(o.value.id)),_&&c&&u&&_.value&&c.value&&u.value?f.recurring={frequency:_.value,repetitionCount:c.value,endDate:u.value}:f.recurring=null,v&&l?z.mutate(f):E.mutate(f)},H=`/groups/${k}`;return(n,t)=>{var c;const g=te,p=L,w=le,o=ae,_=xe;return d(),M(fe,null,[a(g,{label:e(l)?e(l).title:"Nouveau expense",color:(c=e(r))==null?void 0:c.color,to:e(l)?`${H}/expense/${e(v)}`:H},null,8,["label","color","to"]),!e($)||!e(x)?(d(),M("div",Ce,t[1]||(t[1]=[i("p",null,"Chargement...",-1)]))):(d(),N(e(de),{key:1,"initial-values":e($),resolver:e(ve)(e(re)),class:"flex flex-col items-center gap-10 lg:w-2/3 mx-auto",onSubmit:ee},{default:s(u=>{var h,f,q,A,P;return[e(y)&&e(y).length>0?(d(),N(p,{key:0,name:"category",form:u,placeholder:"Catégorie"},{default:s(()=>{var S,W;return[a(e(V),{name:"category",options:e(y),"option-label":"label",class:"w-full md:w-56","label-class":["capitalize",`text-${((W=(S=u.category)==null?void 0:S.value)==null?void 0:W.color)??"gray"}-600`]},null,8,["options","label-class"])]}),_:2},1032,["form"])):K("",!0),a(w,{name:"title",placeholder:"Nom",form:u},null,8,["form"]),i("div",ke,[a(p,{form:u,name:"amount",placeholder:"Prix"},{default:s(()=>[a(e(O),{class:"w-full",name:"amount"})]),_:2},1032,["form"]),t[2]||(t[2]=i("p",{class:"text-3xl font-black mb-1"},"€",-1))]),i("div",De,[a(p,{form:u,name:"author",placeholder:"Auteur"},{default:s(()=>[a(e(V),{name:"author",options:e(x),"option-label":"label","label-class":["capitalize"],class:"w-2/3"},null,8,["options"])]),_:2},1032,["form"]),a(p,{name:"spentAt",form:u,placeholder:"jj/mm/yyyy"},{default:s(()=>[a(e(U),{name:"spentAt","show-icon":"","icon-display":"input","date-format":"dd/mm/yy"})]),_:2},1032,["form"])]),a(o,{label:"Participants",class:"w-full"},{default:s(()=>[a(e(_e),{name:"participants",options:e(x),multiple:"","option-label":"label",class:"w-full",fluid:""},null,8,["options"])]),_:1}),((h=e(r))==null?void 0:h.type)==="daily"?(d(),N(_,{key:1,form:u,"recurring-expense":(f=e(l))==null?void 0:f.recurring},null,8,["form","recurring-expense"])):K("",!0),e(l)?(d(),M("div",Ee,[a(e(B),{class:R([e(I)({color:(q=e(r))==null?void 0:q.color})]),type:"submit"},{default:s(()=>t[3]||(t[3]=[F(" Modifier la dépense ",-1)])),_:1,__:[3]},8,["class"]),a(e(B),{variant:"outlined",class:R(e(I)({color:(A=e(r))==null?void 0:A.color,outlined:!0})),onClick:t[0]||(t[0]=S=>Y())},{default:s(()=>t[4]||(t[4]=[F(" Supprimer la dépense ",-1)])),_:1,__:[4]},8,["class"])])):(d(),N(e(B),{key:3,class:R(["w-64",[e(I)({color:(P=e(r))==null?void 0:P.color})]]),type:"submit"},{default:s(()=>t[5]||(t[5]=[F(" Créer la dépense ",-1)])),_:1,__:[5]},8,["class"]))]}),_:1},8,["initial-values","resolver"]))],64)}}});export{He as _};
