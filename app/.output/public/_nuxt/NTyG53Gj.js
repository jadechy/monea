import{_ as F}from"./CkjdEKrZ.js";import{_ as O}from"./DGr0P_sG.js";import A from"./DJDBaM9R.js";import{e as M,c,o as n,b as m,u as e,G as E,r as C,z as T,s as H,j as K,O as U,K as W,a as p,k as N,w as V,F as j,f as q,n as k,t as J}from"./B4C1c3y9.js";import{g as P}from"./8G3UIhLy.js";import{u as Q}from"./CVCKDgWi.js";import X from"./CAseemDN.js";import"./C_ygJkaK.js";import{h as Y}from"./HNDTOkeZ.js";import{N as Z}from"./Dz4qWlxs.js";import{u as ee}from"./C45g08Ar.js";import{u as te}from"./CfGnfSXj.js";import{a as oe,g as re}from"./CPAmBVur.js";import se from"./AxJl-wT4.js";import ae from"./GLQTXrRA.js";import ie from"./CDF5jS1J.js";import"./BbMESLM0.js";import"./yOe6c3TM.js";import"./3rI856ft.js";import"./FS8s-9Kc.js";import"./DGOriwfr.js";import"./CG7fiWaA.js";import"./B-SteLpu.js";import"./jc0MLXVe.js";import"./ZhWAdK_X.js";import"./C1pTgOiJ.js";import"./CLs7nh7g.js";import"./Sx2Q1i01.js";import"./BG6yOVPh.js";import"./wgfyke9o.js";import"./DD9exzw8.js";import"./BTinR4uF.js";import"./DFCF-WRp.js";import"./DFRwXp6x.js";import"./BP-om_zl.js";import"./Drkg7K07.js";import"./DfIvkuC_.js";import"./DDRO_9ox.js";const le={class:"w-full flex justify-center h-24"},ue=M({__name:"LoadingComponent",setup(D){return(b,f)=>(n(),c("div",le,[m(e(A),{"aria-label":"Loading"})]))}}),ne={class:"w-full flex justify-center"},me={class:"grid gap-2 grid-cols-2 md:grid-cols-3 mt-6 w-full"},pe={class:"flex items-center gap-2"},Qe=M({__name:"edit",setup(D){var $,x,y,h,S;const b=E(),{group_id:f}=b.params,s=C(null);T(()=>{s.value=new Date});const{group:a}=H(K()),g=C(null),{categories:l}=te();ee({title:`Modifier le budget du groupe ${($=a.value)==null?void 0:$.name}`,description:`Ajustez les montants par catégorie, modifiez les plafonds mensuels et gérez les priorités budgétaires du groupe ${(x=a.value)==null?void 0:x.name}.`,ogTitle:`Édition du budget - ${(y=a.value)==null?void 0:y.name}`,ogDescription:`Modifiez le budget partagé du groupe ${(h=a.value)==null?void 0:h.name} : ajustez les catégories, maîtrisez vos dépenses et anticipez les imprévus.`,image:((S=a.value)==null?void 0:S.picture)??void 0});const{refetchBudget:G,postBudgetsMutation:I,budgetList:v}=Q(s),w=()=>!v.value||!l.value?{}:l.value.reduce((t,o)=>{var u;return t[o.id]=((u=v.value.find(r=>Number(r.category.id)===Number(o.id)))==null?void 0:u.amount)??0,t},{});U(s,async()=>{if(l.value&&(await G(),g.value)){const t=w();g.value.setValues(t)}});const L=t=>{if(!t.valid||!l.value||!s.value)return;const o=Object.entries(t.states).map(r=>{var d;return{amount:Number(r[1]&&((d=r[1])!=null&&d.value)?r[1].value:0),monthStart:oe(re(s.value)),categoryId:Number(r[0])}}),u={groupId:Number(f),budgets:o};I.mutate(u)},R=W(()=>w());return(t,o)=>{var B;const u=F,r=O,d=ue;return n(),c(j,null,[m(u,{label:"Edition des Budgets",color:(B=e(a))==null?void 0:B.color,to:`/groups/${e(f)}/budget`},null,8,["color","to"]),p("div",ne,[m(e(se),{modelValue:s.value,"onUpdate:modelValue":o[0]||(o[0]=_=>s.value=_),view:"month","date-format":"mm/yy",class:"w-64 mt-3","input-class":"text-center"},null,8,["modelValue"])]),e(v)&&e(l)?(n(),N(e(X),{key:0,ref_key:"formRef",ref:g,"initial-values":R.value,resolver:e(Y)(e(Z)),class:"flex justify-center flex-col items-center gap-10",onSubmit:L},{default:V(_=>{var z;return[p("section",me,[(n(!0),c(j,null,q(e(l),i=>(n(),c("div",{key:i.id,class:k(["flex justify-between items-center rounded-full px-4 py-3",`bg-${i.color}-50 text-${i.color}-800`])},[p("p",null,J(i.label!=="default"?i.label:"Autres"),1),p("div",pe,[m(r,{form:_,name:String(i.id),placeholder:"Budget",class:"w-24"},{default:V(()=>[m(e(ae),{name:String(i.id),fluid:""},null,8,["name"])]),_:2},1032,["form","name"]),o[1]||(o[1]=p("p",{class:"text-2xl"},"€",-1))])],2))),128))]),m(e(ie),{class:k([[("getGroupColor"in t?t.getGroupColor:e(P))({color:(z=e(a))==null?void 0:z.color})],"w-64"]),type:"submit",label:"Sauvergarde les budgets"},null,8,["class"])]}),_:1},8,["initial-values","resolver"])):(n(),N(d,{key:1}))],64)}}});export{Qe as default};
