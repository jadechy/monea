import{a2 as o,a9 as c,ah as A,a4 as n,a8 as I,a3 as K,a5 as E,ai as Q,aj as h,a1 as k,a6 as B,ak as _,al as N,a0 as R,am as j,J as O,g as U,Y as V,Z as u,q as x}from"./9_oEEP4X.js";import{a as J,e as P}from"./CPAmBVur.js";const Y=A(["daily","monthly","weekly","yearly"]),v=o({id:n(),repetitionCount:n(),frequency:Y,endDate:c().datetime({offset:!0})}),Z=v.pick({frequency:!0,repetitionCount:!0,endDate:!0}),y=o({id:n({required_error:"Identifiant requis",invalid_type_error:"L'identifiant doit être un nombre"}),amount:n({required_error:"Le montant est requis",invalid_type_error:"Le montant doit être un nombre"}).positive("Le montant doit être positif"),title:c({required_error:"Le titre est requis",invalid_type_error:"Le titre doit être une chaîne de caractères"}).min(3,"Le titre doit contenir au moins 3 caractères").max(255,"Le titre doit contenir au maximum 255 caractères"),groupe:B.shape.id,category:k,creator:h,spentAt:Q,recurring:v.nullable(),participants:E(h,{invalid_type_error:"Les participants doivent être une liste d'utilisateurs"}).optional()}),te=o({id:n().optional(),categoryId:n().optional(),title:y.shape.title,amount:y.shape.amount,spentAt:N(),authorId:_.shape.id,groupId:B.shape.id,recurring:Z.nullable().optional(),participants:E(_.shape.id)}),z=y.pick({amount:!0,id:!0,title:!0,category:!0}).extend({creator:h.pick({picture:!0,username:!0})}),H=E(z,{invalid_type_error:"Les dépenses doivent être une liste"}),g=I(K,H),W=()=>{const{$api:s}=R();return{getExpenseById:e=>s.get({url:`expenses/${e}`,schema:y}),getAllExpensesByGroup:e=>s.get({url:`expenses/groupe/${e}/list`,schema:g}),getMonthlyExpensesByGroup:(e,r)=>s.get({url:`expenses/groupe/${e}/mois/${J(r)}/list`,schema:g}),getExpensesByCategory:e=>s.get({url:`expenses/category/${e}/list`,schema:g}),postExpense:e=>s.post({url:"expenses",body:e,schema:o({message:c()})}),patchExpense:(e,r)=>s.patch({url:`expenses/${e}`,body:r,schema:o({message:c()})}),deleteExpense:e=>s.delete({url:`expenses/${e}`,schema:j()})}},se=()=>{const s=O(),{group_id:t,category_id:i,expense_id:a}=s.params,p=U(),{postExpense:q,getExpenseById:S,patchExpense:b,deleteExpense:e,getAllExpensesByGroup:r,getExpensesByCategory:f,getMonthlyExpensesByGroup:M}=W(),d=V(),l=async()=>{await Promise.all([d.invalidateQueries({queryKey:["expenses-by-group",t]}),d.invalidateQueries({queryKey:["budget","remaining",Number(t)]})])},{data:C}=u({queryKey:["expense-by-id",a],queryFn:()=>S(a),enabled:!!a}),L=x({mutationFn:m=>q(m),onSuccess:async()=>{await l(),p.push(`/groups/${t}`)}}),$=x({mutationFn:m=>b(a,m),onSuccess:async()=>{await d.invalidateQueries({queryKey:["expense-by-id",a]}),await l(),await p.push({name:"expense",params:{id:a,group_id:t}})}}),w=x({mutationFn:()=>e(a),onSuccess:async()=>{await l(),p.push(`/groups/${t}`)}}),{data:D}=u({queryKey:["expenses-by-group",t],queryFn:()=>r(t),enabled:!!t}),{data:F}=u({queryKey:["expenses-by-category",i],queryFn:()=>f(i),enabled:i!==void 0}),{data:G,refetch:T}=u({queryKey:["expenses-monthly-group",t],queryFn:()=>M(t,P())});return{expenses:D,expense:C,createExpenseMutation:L,updateExpenseMutation:$,deleteExpenseMutation:w,expensesByCategory:F,expensesByMonthAndGroup:G,refetchByMonthAndGroup:T}};export{Y as F,te as N,se as u};
