import{_ as O}from"./BXLN-2ti.js";import{_ as A}from"./Ct2Kg15V.js";import E from"./DjKDYq-Q.js";import{d as I,c as f,o as m,b as p,u as e,H,r as V,B as T,j as P,k as U,P as W,M as q,e as d,l as j,w as k,F as z,a as J,n as M,t as K,g as Q}from"./DZ2khTnM.js";import{g as X}from"./8G3UIhLy.js";import Y from"./BVLwsKNB.js";import{u as Z}from"./Bh-hiYRa.js";import ee from"./BQuv8gv2.js";import"./D0fJx_nL.js";import{h as te}from"./DuJv_D_N.js";import{N as oe}from"./Dtrs6cea.js";import{u as re}from"./DDT-kY3b.js";import{u as se}from"./jzm56w66.js";import{a as ae,g as ue}from"./CPAmBVur.js";import ie from"./CFd5_Piq.js";import"./xFnIkFpr.js";import"./6sD3ePS7.js";import"./BpxfxKT9.js";import"./BK5zw7wc.js";import"./9bD6E8Nq.js";import"./Cnm4LbfB.js";import"./Hbwuj-1z.js";import"./BO-eBnTB.js";import"./CLs7nh7g.js";import"./DQrM28XS.js";import"./dV31eLeC.js";import"./B3kXyQam.js";import"./DPiWrF-R.js";import"./kD-r-boF.js";import"./N6u5SXv9.js";import"./BCFG6or-.js";const le={class:"w-full flex justify-center h-24"},ne=I({__name:"LoadingComponent",setup(D){return(w,g)=>(m(),f("div",le,[p(e(E),{"aria-label":"Loading"})]))}}),me={class:"w-full flex justify-center"},pe={class:"grid gap-2 grid-cols-2 md:grid-cols-3 mt-6 w-full"},ce={class:"flex items-center gap-2"},Pe=I({__name:"edit",setup(D){var x,y,N,h,S;const w=H(),{group_id:g}=w.params,a=V(null);T(()=>{a.value=new Date});const{group:u}=P(U()),v=V(null),{categories:l}=se();re({title:`Modifier le budget du groupe ${(x=u.value)==null?void 0:x.name}`,description:`Ajustez les montants par catégorie, modifiez les plafonds mensuels et gérez les priorités budgétaires du groupe ${(y=u.value)==null?void 0:y.name}.`,ogTitle:`Édition du budget - ${(N=u.value)==null?void 0:N.name}`,ogDescription:`Modifiez le budget partagé du groupe ${(h=u.value)==null?void 0:h.name} : ajustez les catégories, maîtrisez vos dépenses et anticipez les imprévus.`,image:((S=u.value)==null?void 0:S.picture)??void 0});const{refetchBudget:L,postBudgetsMutation:R,budgetList:_}=Z(a),$=()=>!_.value||!l.value?{}:l.value.reduce((t,o)=>{var n;return t[o.id]=((n=_.value.find(r=>Number(r.category.id)===Number(o.id)))==null?void 0:n.amount)??0,t},{});W(a,async()=>{if(l.value&&(await L(),v.value)){const t=$();v.value.setValues(t)}});const F=t=>{if(!t.valid||!l.value||!a.value)return;const o=Object.entries(t.states).filter(([r,s])=>{const c=Number(s==null?void 0:s.value);return!isNaN(c)&&c>=0&&c<=9999}).map(r=>{var s;return{amount:Number(r[1]&&((s=r[1])!=null&&s.value)?r[1].value:0),monthStart:ae(ue(a.value)),categoryId:Number(r[0])}}),n={groupId:Number(g),budgets:o};R.mutate(n)},G=q(()=>$());return(t,o)=>{var B;const n=O,r=Y,s=A,c=ne;return m(),f(z,null,[p(n,{label:"Edition des Budgets",color:(B=e(u))==null?void 0:B.color,to:`/groups/${e(g)}/budget`},null,8,["color","to"]),d("div",me,[p(e(ie),{modelValue:a.value,"onUpdate:modelValue":o[0]||(o[0]=b=>a.value=b),view:"month","date-format":"mm/yy",class:"w-64 mt-3","input-class":"text-center"},null,8,["modelValue"])]),e(_)&&e(l)?(m(),j(e(ee),{key:0,ref_key:"formRef",ref:v,"initial-values":G.value,resolver:e(te)(e(oe)),class:"flex justify-center flex-col items-center gap-10",onSubmit:F},{default:k(b=>{var C;return[d("section",pe,[(m(!0),f(z,null,J(e(l),i=>(m(),f("div",{key:i.id,class:M(["flex justify-between items-center rounded-full px-4 py-3",`bg-${i.color}-50 text-${i.color}-800`])},[d("p",null,K(i.label!=="default"?i.label:"Autres"),1),d("div",ce,[p(s,{form:b,name:String(i.id),placeholder:"Budget",class:"w-24"},{default:k(()=>[p(r,{name:String(i.id),fluid:""},null,8,["name"])]),_:2},1032,["form","name"]),o[1]||(o[1]=d("p",{class:"text-2xl"},"€",-1))])],2))),128))]),p(e(Q),{class:M([[("getGroupColor"in t?t.getGroupColor:e(X))({color:(C=e(u))==null?void 0:C.color})],"w-64"]),type:"submit",label:"Sauvergarde les budgets"},null,8,["class"])]}),_:1},8,["initial-values","resolver"])):(m(),j(c,{key:1}))],64)}}});export{Pe as default};
