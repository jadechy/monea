import{_ as te}from"./D0rdmbf4.js";import{_ as L}from"./BKOpyFtq.js";import{_ as le}from"./t2BEU9GA.js";import{_ as oe}from"./DqpWn3_z.js";import{F as ae,u as re,N as ne}from"./PuE3qyRS.js";import se from"./De1U4e1x.js";import Q from"./Dp-9aMN4.js";import V from"./BaXpxPL1.js";import J from"./RzJ5KDvm.js";import{e as O,r as U,c as F,k as q,o as d,a as i,u as e,w as s,d as M,b as o,K as X,$ as ue,s as ie,j as me,i as pe,I as j,W as ce,l as H,n as B,F as fe}from"./CNJ8szB1.js";import{g as I}from"./8G3UIhLy.js";import de from"./UyM0iugl.js";import"./DNTzeJw7.js";import{h as ve}from"./CURxPC38.js";import{c as ye}from"./CPAmBVur.js";import{u as ge}from"./Bs-gFcw3.js";import _e from"./Ggfy6CN2.js";import R from"./BA-yyycA.js";const be={class:"flex lg:justify-center items-center gap-4 flex-wrap w-full"},xe=O({__name:"RecurringExpenseFormComponent",props:{form:{},recurringExpense:{default:null}},setup(C){const m=U(C.recurringExpense!==void 0),{repetitionCount:k,frequency:D,endDate:v,spentAt:n}=C.form,b=()=>{k.value=null,D.value=null,v.value=null,m.value=!1};return(y,l)=>{const E=L;return m.value?(d(),q(e(se),{key:1,class:"w-full"},{content:s(()=>[i("div",be,[o(E,{form:y.form,name:"repetitionCount",placeholder:"Nombre de fois",class:"max-w-26"},{default:s(()=>[o(e(Q),{class:"w-full",name:"repetitionCount",fluid:""})]),_:1},8,["form"]),l[2]||(l[2]=i("p",null,"par",-1)),o(E,{name:"frequency",form:y.form,placeholder:"Récurrence",class:"max-w-32"},{default:s(()=>[o(e(V),{name:"frequency",options:e(ae).options,class:"w-full","label-class":"capitalize",fluid:""},null,8,["options"])]),_:1},8,["form"]),l[3]||(l[3]=i("p",null,"jusqu'au",-1)),o(E,{name:"endDate",form:y.form,placeholder:"jj/mm/yyyy",class:"max-w-34"},{default:s(()=>[o(e(J),{name:"endDate","show-icon":"","icon-display":"input",fluid:"","min-date":e(n)?new Date(e(n).value):void 0,"date-format":"dd/mm/yy"},null,8,["min-date"])]),_:1},8,["form"])])]),footer:s(()=>[i("p",{class:"item hover w-fit mx-auto mt-12",onClick:b},l[4]||(l[4]=[i("i",{class:"pi pi-times-circle mr-2"},null,-1),M("Supprimer la récurrence ")]))]),_:1})):(d(),F("div",{key:0,class:"item hover",onClick:l[0]||(l[0]=z=>m.value=!0)},l[1]||(l[1]=[i("p",null,"Créer une récurrence",-1),i("i",{class:"pi pi-arrow-right"},null,-1)])))}}}),we=()=>{const C=X(),{group_id:m}=C.params,{getMembersByGroup:k}=ge(),{data:D}=ue({queryKey:["members-by-group",m],queryFn:()=>k(m),enabled:!!m});return{members:D}},Ce={key:0,class:"flex justify-center p-8"},ke={class:"flex gap-4 w-full items-end"},De={class:"flex justify-between w-full gap-4"},Ee={key:2,class:"flex flex-col gap-3 w-64"},Pe=O({__name:"ExpenseForm",setup(C){const m=X(),{group_id:k,category_id:D,expense_id:v}=m.params;console.log(v);const{group:n}=ie(me()),{user:b}=pe(),y=j(()=>{var r;return n.value?(r=n==null?void 0:n.value.categories)==null?void 0:r.filter(t=>t.label!=="default"):[]}),{expense:l,createExpenseMutation:E,updateExpenseMutation:z,deleteExpenseMutation:Y}=re(),{members:G}=we(),x=j(()=>{var r;return(r=G.value)==null?void 0:r.map(t=>({label:t.user.username,value:t.user.id}))}),T=r=>j(()=>{var t;return r&&((t=x.value)==null?void 0:t.filter(g=>g.value===r)[0])}),Z=()=>{v&&confirm("Es-tu sûr de vouloir supprimer la dépense ?")&&Y.mutate()},N=U();ce(()=>{var r,t,g,p,w;if(!(!G.value||!x.value))if(l!=null&&l.value){const a=l.value;N.value={title:a.title,amount:a.amount,spentAt:new Date(a.spentAt),author:T(a.creator.id).value,category:a.category.label!=="default"?a.category:null,frequency:((r=a.recurring)==null?void 0:r.frequency)??null,repetitionCount:((t=a.recurring)==null?void 0:t.repetitionCount)??null,endDate:((g=a.recurring)==null?void 0:g.endDate)??null,participants:((p=a.participants)==null?void 0:p.map(_=>{var c;return(c=x.value)==null?void 0:c.find(u=>u.value===_.id)}).filter(Boolean))||[]}}else N.value={title:"",amount:null,spentAt:new Date,author:b&&T(b==null?void 0:b.id).value,category:(w=y.value)==null?void 0:w.find(a=>a.id===Number(D)),frequency:null,repetitionCount:null,endDate:null,participants:[]}});const ee=r=>{var $;if(!r.valid||!n.value)return;const{title:t,amount:g,spentAt:p,author:w,category:a,frequency:_,repetitionCount:c,endDate:u,participants:h}=r.states,f={title:t.value,amount:g.value,spentAt:ye(new Date(p.value)),groupId:n.value.id,authorId:w.value.value,participants:($=h.value)==null?void 0:$.map(A=>A.value)};v&&(f.id=Number(v)),a&&a.value&&(f.categoryId=Number(a.value.id)),_&&c&&u&&_.value&&c.value&&u.value?f.recurring={frequency:_.value,repetitionCount:c.value,endDate:u.value}:f.recurring=null,v&&l?z.mutate(f):E.mutate(f)},W=`/groups/${k}`;return(r,t)=>{var c;const g=te,p=L,w=le,a=oe,_=xe;return d(),F(fe,null,[o(g,{label:e(l)?e(l).title:"Nouveau expense",color:(c=e(n))==null?void 0:c.color,to:e(l)?`${W}/expense/${e(v)}`:W},null,8,["label","color","to"]),!e(N)||!e(x)?(d(),F("div",Ce,t[1]||(t[1]=[i("p",null,"Chargement...",-1)]))):(d(),q(e(de),{key:1,"initial-values":e(N),resolver:e(ve)(e(ne)),class:"flex flex-col items-center gap-10 lg:w-2/3 mx-auto",onSubmit:ee},{default:s(u=>{var h,f,$,A,K;return[e(y)&&e(y).length>0?(d(),q(p,{key:0,name:"category",form:u,placeholder:"Catégorie"},{default:s(()=>{var S,P;return[o(e(V),{name:"category",options:e(y),"option-label":"label",class:"w-full md:w-56","label-class":["capitalize",`text-${((P=(S=u.category)==null?void 0:S.value)==null?void 0:P.color)??"gray"}-600`]},null,8,["options","label-class"])]}),_:2},1032,["form"])):H("",!0),o(w,{name:"title",placeholder:"Nom",form:u},null,8,["form"]),i("div",ke,[o(p,{form:u,name:"amount",placeholder:"Prix"},{default:s(()=>[o(e(Q),{class:"w-full",name:"amount"})]),_:2},1032,["form"]),t[2]||(t[2]=i("p",{class:"text-3xl font-black mb-1"},"€",-1))]),i("div",De,[o(p,{form:u,name:"author",placeholder:"Auteur"},{default:s(()=>[o(e(V),{name:"author",options:e(x),"option-label":"label","label-class":["capitalize"],class:"w-2/3"},null,8,["options"])]),_:2},1032,["form"]),o(p,{name:"spentAt",form:u,placeholder:"jj/mm/yyyy"},{default:s(()=>[o(e(J),{name:"spentAt","show-icon":"","icon-display":"input","date-format":"dd/mm/yy"})]),_:2},1032,["form"])]),o(a,{label:"Participants",class:"w-full"},{default:s(()=>[o(e(_e),{name:"participants",options:e(x),multiple:"","option-label":"label",class:"w-full",fluid:""},null,8,["options"])]),_:1}),((h=e(n))==null?void 0:h.type)==="daily"?(d(),q(_,{key:1,form:u,"recurring-expense":(f=e(l))==null?void 0:f.recurring},null,8,["form","recurring-expense"])):H("",!0),e(l)?(d(),F("div",Ee,[o(e(R),{class:B([e(I)({color:($=e(n))==null?void 0:$.color})]),type:"submit"},{default:s(()=>t[3]||(t[3]=[M(" Modifier la dépense ")])),_:1,__:[3]},8,["class"]),o(e(R),{variant:"outlined",class:B(e(I)({color:(A=e(n))==null?void 0:A.color,outlined:!0})),onClick:t[0]||(t[0]=S=>Z())},{default:s(()=>t[4]||(t[4]=[M(" Supprimer la dépense ")])),_:1,__:[4]},8,["class"])])):(d(),q(e(R),{key:3,class:B(["w-64",[e(I)({color:(K=e(n))==null?void 0:K.color})]]),type:"submit"},{default:s(()=>t[5]||(t[5]=[M(" Créer la dépense ")])),_:1,__:[5]},8,["class"]))]}),_:1},8,["initial-values","resolver"]))],64)}}});export{Pe as _};
