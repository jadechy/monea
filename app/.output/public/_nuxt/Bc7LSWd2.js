import{_ as G}from"./D-QH4Wn2.js";import{_ as O}from"./jKQ0kXKy.js";import A from"./Bt3TVLYg.js";import{e as M,c,o as n,b as m,u as e,P as E,r as N,y as H,s as T,j as J,J as P,H as U,a as p,k as V,w as j,F as k,f as W,n as z,t as q}from"./DrJXerId.js";import{g as K}from"./8G3UIhLy.js";import{u as Q}from"./DOffVD9L.js";import X from"./DtAOWCUE.js";import"./BDBuLOO9.js";import{h as Y}from"./LPp198AV.js";import{N as Z}from"./m3jqOzSH.js";import{u as ee}from"./BZxOlZYc.js";import{u as te}from"./_8Si6717.js";import{a as oe,g as re}from"./CPAmBVur.js";import se from"./DDGwsn6e.js";import ae from"./C1AKM2pZ.js";import ie from"./BgkWlaQ2.js";import"./BhSvIonp.js";import"./BpAAe-1L.js";import"./CiBKH_74.js";import"./DE4ntUwA.js";import"./DqNSWbbH.js";import"./BPvQVBk-.js";import"./B4rtYYsy.js";import"./jc0MLXVe.js";import"./ZhWAdK_X.js";import"./DpZJTOLv.js";import"./CLs7nh7g.js";import"./CLtqqp3k.js";import"./NnhJwPhx.js";import"./DcMwszoC.js";import"./zNHSbXkv.js";import"./DTwhDaa8.js";import"./CXQQPXb0.js";import"./BO29QJ_F.js";import"./C5VsqFZ3.js";import"./Dq8-Xy11.js";import"./DnrMt6XD.js";import"./DnNiQNc-.js";const le={class:"w-full flex justify-center h-24"},ue=M({__name:"LoadingComponent",setup(D){return(b,f)=>(n(),c("div",le,[m(e(A),{"aria-label":"Loading"})]))}}),ne={class:"w-full flex justify-center"},me={class:"grid gap-2 grid-cols-2 md:grid-cols-3 mt-6 w-full"},pe={class:"flex items-center gap-2"},Qe=M({__name:"edit",setup(D){var $,y,x,h,S;const b=E(),{group_id:f}=b.params,s=N(null);H(()=>{s.value=new Date});const{group:a}=T(J()),g=N(null),{categories:l}=te();ee({title:`Modifier le budget du groupe ${($=a.value)==null?void 0:$.name}`,description:`Ajustez les montants par catégorie, modifiez les plafonds mensuels et gérez les priorités budgétaires du groupe ${(y=a.value)==null?void 0:y.name}.`,ogTitle:`Édition du budget - ${(x=a.value)==null?void 0:x.name}`,ogDescription:`Modifiez le budget partagé du groupe ${(h=a.value)==null?void 0:h.name} : ajustez les catégories, maîtrisez vos dépenses et anticipez les imprévus.`,image:((S=a.value)==null?void 0:S.picture)??void 0});const{refetchBudget:I,postBudgetsMutation:L,budgetList:v}=Q(s),w=()=>!v.value||!l.value?{}:l.value.reduce((t,o)=>{var u;return t[o.id]=((u=v.value.find(r=>Number(r.category.id)===Number(o.id)))==null?void 0:u.amount)??0,t},{});P(s,async()=>{if(l.value&&(await I(),g.value)){const t=w();g.value.setValues(t)}});const R=t=>{if(!t.valid||!l.value||!s.value)return;const o=Object.entries(t.states).map(r=>{var d;return{amount:Number(r[1]&&((d=r[1])!=null&&d.value)?r[1].value:0),monthStart:oe(re(s.value)),categoryId:Number(r[0])}}),u={groupId:Number(f),budgets:o};L.mutate(u)},F=U(()=>w());return(t,o)=>{var B;const u=G,r=O,d=ue;return n(),c(k,null,[m(u,{label:"Edition des Budgets",color:(B=e(a))==null?void 0:B.color,to:`/groups/${e(f)}/budget`},null,8,["color","to"]),p("div",ne,[m(e(se),{modelValue:s.value,"onUpdate:modelValue":o[0]||(o[0]=_=>s.value=_),view:"month","date-format":"mm/yy",class:"w-64 mt-3","input-class":"text-center"},null,8,["modelValue"])]),e(v)&&e(l)?(n(),V(e(X),{key:0,ref_key:"formRef",ref:g,"initial-values":F.value,resolver:e(Y)(e(Z)),class:"flex justify-center flex-col items-center gap-10",onSubmit:R},{default:j(_=>{var C;return[p("section",me,[(n(!0),c(k,null,W(e(l),i=>(n(),c("div",{key:i.id,class:z(["flex justify-between items-center rounded-full px-4 py-3",`bg-${i.color}-50 text-${i.color}-800`])},[p("p",null,q(i.label!=="default"?i.label:"Autres"),1),p("div",pe,[m(r,{form:_,name:String(i.id),placeholder:"Budget",class:"w-24"},{default:j(()=>[m(e(ae),{name:String(i.id),fluid:""},null,8,["name"])]),_:2},1032,["form","name"]),o[1]||(o[1]=p("p",{class:"text-2xl"},"€",-1))])],2))),128))]),m(e(ie),{class:z([[("getGroupColor"in t?t.getGroupColor:e(K))({color:(C=e(a))==null?void 0:C.color})],"w-64"]),type:"submit",label:"Sauvergarde les budgets"},null,8,["class"])]}),_:1},8,["initial-values","resolver"])):(n(),V(d,{key:1}))],64)}}});export{Qe as default};
