import{_ as tt}from"./BXLN-2ti.js";import{_ as et,t as ot,h as rt}from"./xNRdtxRc.js";import{_ as at}from"./BY0E9GD9.js";import st from"./Dh03R6aa.js";import nt from"./D75R_y9V.js";import R from"./BX6MTX98.js";import it from"./BwAdD26J.js";import A from"./gpvAhEqr.js";import{W as lt,X as ut,N as ct,c as k,o as m,e as O,Y as F,d as E,r as _,l as h,u as o,j as q,k as X,Z as pt,w as f,b as d,q as M,f as dt,H as mt,m as I,n as L,g as z,F as K,p as ft,a as gt,t as W}from"./DZ2khTnM.js";import{b as ht,d as bt,a as Y,e as J}from"./CPAmBVur.js";import{u as yt}from"./BgF1Ijsv.js";import{g as H}from"./8G3UIhLy.js";import{u as vt}from"./Bh-hiYRa.js";import{u as _t}from"./DDT-kY3b.js";import{u as Ct}from"./jzm56w66.js";import"./Dtrs6cea.js";import"./B3kXyQam.js";import"./DPiWrF-R.js";var $t={root:{position:"relative"}},wt={root:"p-chart"},St=lt.extend({name:"chart",classes:wt,inlineStyles:$t}),kt={name:"BaseChart",extends:ut,props:{type:String,data:null,options:null,plugins:null,width:{type:Number,default:300},height:{type:Number,default:150},canvasProps:{type:null,default:null}},style:St,provide:function(){return{$pcChart:this,$parentInstance:this}}},N={name:"Chart",extends:kt,inheritAttrs:!1,emits:["select","loaded"],chart:null,watch:{data:{handler:function(){this.reinit()},deep:!0},type:function(){this.reinit()},options:function(){this.reinit()}},mounted:function(){this.initChart()},beforeUnmount:function(){this.chart&&(this.chart.destroy(),this.chart=null)},methods:{initChart:function(){var t=this;ct(()=>import("./CSZ8dA-i.js"),[],import.meta.url).then(function(r){t.chart&&(t.chart.destroy(),t.chart=null),r&&r.default&&(t.chart=new r.default(t.$refs.canvas,{type:t.type,data:t.data,options:t.options,plugins:t.plugins})),t.$emit("loaded",t.chart)})},getCanvas:function(){return this.$canvas},getChart:function(){return this.chart},getBase64Image:function(){return this.chart.toBase64Image()},refresh:function(){this.chart&&this.chart.update()},reinit:function(){this.initChart()},onCanvasClick:function(t){if(this.chart){var r=this.chart.getElementsAtEventForMode(t,"nearest",{intersect:!0},!1),a=this.chart.getElementsAtEventForMode(t,"dataset",{intersect:!0},!1);r&&r[0]&&a&&this.$emit("select",{originalEvent:t,element:r[0],dataset:a})}},generateLegend:function(){if(this.chart)return this.chart.generateLegend()}}};function j(e){"@babel/helpers - typeof";return j=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},j(e)}function U(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}function Z(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?U(Object(r),!0).forEach(function(a){Ot(e,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):U(Object(r)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})}return e}function Ot(e,t,r){return(t=jt(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function jt(e){var t=Et(e,"string");return j(t)=="symbol"?t:t+""}function Et(e,t){if(j(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var a=r.call(e,t);if(j(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Bt=["width","height"];function Pt(e,t,r,a,c,n){return m(),k("div",F({class:e.cx("root"),style:e.sx("root")},e.ptmi("root")),[O("canvas",F({ref:"canvas",width:e.width,height:e.height,onClick:t[0]||(t[0]=function(s){return n.onCanvasClick(s)})},Z(Z({},e.canvasProps),e.ptm("canvas"))),null,16,Bt)],16)}N.render=Pt;var Q={gray:{900:"oklch(21% 0.034 264.665)"}};const Dt=E({__name:"ChartCategory",props:{budgets:{}},setup(e){const t=n=>{if(typeof window>"u")return"#000000";const s=document.createElement("div");s.className=`bg-${n}`,s.style.display="none",document.body.appendChild(s);const l=getComputedStyle(s).backgroundColor;return document.body.removeChild(s),l},r=e,a=_({labels:r.budgets.map(n=>n.category.label),datasets:[{data:r.budgets.map(n=>n.amount),backgroundColor:r.budgets.map(n=>t(`${n.category.color}-400`)),hoverBackgroundColor:r.budgets.map(n=>t(`${n.category.color}-600`))}]}),c=_({plugins:{legend:{position:"bottom",labels:{color:Q.gray[900]}}}});return(n,s)=>(m(),h(o(N),{type:"pie",data:a.value,options:c.value,class:"w-[40rem] flex justify-center"},null,8,["data","options"]))}}),Tt=E({__name:"ChartCategoryBalance",props:{budgets:{}},setup(e){const t=s=>{if(typeof window>"u")return"#000000";const l=document.createElement("div");l.className=`bg-${s}`,l.style.display="none",document.body.appendChild(l);const p=getComputedStyle(l).backgroundColor;return document.body.removeChild(l),p},r=e,a=r.budgets.reduce((s,l)=>{const p=l.category.id;return s[p]||(s[p]={label:l.category.label||"Sans nom",color:l.category.color,total:0}),s[p].total+=l.amount,s},{}),c=_({labels:r.budgets.map(s=>s.category.label),datasets:[{label:"Object",data:Object.values(a).map(s=>s.total),backgroundColor:Object.values(a).map(s=>t(`${s.color}-400`))},{label:"Réel",data:Object.values(a).map(()=>100),backgroundColor:Object.values(a).map(s=>t(`${s.color}-200`))}]}),n=_({responsive:!0,plugins:{legend:{position:"bottom",labels:{color:Q.gray[900]}}}});return(s,l)=>(m(),h(o(N),{type:"bar",data:c.value,options:n.value,class:"w-[40rem] flex justify-center"},null,8,["data","options"]))}}),It=E({__name:"ChartLinearEvolution",setup(e){const{group:t}=q(X()),r=ht(),a=r.map(l=>bt(l)),{expensesByMonthAndGroup:c}=yt(),n=_({labels:[],datasets:[]}),s=_({responsive:!0,plugins:{legend:{position:"bottom",labels:{color:"#1f2937"}}},scales:{x:{ticks:{color:"#6b7280",maxRotation:45,minRotation:20,autoSkip:!0,maxTicksLimit:6}},y:{beginAtZero:!0,ticks:{color:"#6b7280"}}},elements:{point:{radius:0}}});return pt(()=>{var C;if(!((C=t.value)!=null&&C.categories)||!c.value)return;const l=t.value.categories.filter(i=>Object.values(c.value??{}).some(u=>u.some($=>$.category.id===i.id))),p={},v=new Array(a.length).fill(0);l.forEach(i=>{p[i.id]=new Array(a.length).fill(0)}),r.forEach((i,u)=>{var D;const $=i.toISOString().slice(0,10),w=((D=c.value)==null?void 0:D[$])??[];let P=0;w.forEach(b=>{const y=b.category.id,S=b.amount,T=u>0?p[y][u-1]:0;p[y][u]=T+S,P+=S}),l.forEach(b=>{w.some(y=>y.category.id===b.id)||(p[b.id][u]=u>0?p[b.id][u-1]:0)}),v[u]=(u>0?v[u-1]:0)+P});const B=[{label:"Total des dépenses",data:v,borderColor:"#111827",backgroundColor:"#111827",borderWidth:4,tension:.05,fill:!1},...l.map(i=>({label:i.label??`Catégorie ${i.id}`,data:p[i.id],borderColor:i.color,backgroundColor:i.color,borderWidth:2,tension:.05,fill:!1}))];n.value={labels:a,datasets:B}}),(l,p)=>(m(),h(o(N),{type:"line",data:o(n),options:o(s),class:"w-[40rem] flex justify-center"},null,8,["data","options"]))}}),Mt=E({__name:"ChartLayout",props:{budgets:{}},setup(e){return(t,r)=>(m(),h(o(st),{value:"0"},{default:f(()=>[d(o(nt),null,{default:f(()=>[d(o(R),{value:"0"},{default:f(()=>r[0]||(r[0]=[M("Budget par catégories",-1)])),_:1,__:[0]}),d(o(R),{value:"1"},{default:f(()=>r[1]||(r[1]=[M("Initial / Réalité",-1)])),_:1,__:[1]}),d(o(R),{value:"2"},{default:f(()=>r[2]||(r[2]=[M("Evolution des dépenses",-1)])),_:1,__:[2]})]),_:1}),d(o(it),{class:"full"},{default:f(()=>[d(o(A),{value:"0",class:"flex justify-center h-64 w-full"},{default:f(()=>[d(Dt,{budgets:t.budgets.filter(a=>a.monthStart===o(Y)(o(J)()))},null,8,["budgets"])]),_:1}),d(o(A),{value:"1",class:"flex justify-center h-64 w-full"},{default:f(()=>[d(Tt,{budgets:t.budgets},null,8,["budgets"])]),_:1}),d(o(A),{value:"2",class:"flex justify-center h-64 w-full"},{default:f(()=>[d(It)]),_:1})]),_:1})]),_:1}))}}),Nt={key:0,class:"flex flex-col gap-10"},Rt={class:"flex justify-between"},At={class:"flex gap-5 w-full"},Lt={class:"grid gap-2 grid-cols-2 md:grid-cols-3"},zt={key:0},ae=E({__name:"index",setup(e){var l,p,v,B,C;const t=dt(),r=mt(),{group_id:a}=r.params,{remainingBudget:c}=vt(),{group:n}=q(X());_t({title:`Suivi du budget du groupe ${(l=n.value)==null?void 0:l.name}`,description:`Visualisez, gérez et optimisez le budget mensuel et les dépenses par catégorie du groupe ${(p=n.value)==null?void 0:p.name}. Gardez le contrôle sur vos finances partagées.`,ogTitle:`Budget du groupe ${(v=n.value)==null?void 0:v.name}`,ogDescription:`Suivi complet du budget du groupe ${(B=n.value)==null?void 0:B.name} : répartition par catégorie, dépenses mensuelles et gestion partagée des finances.`,image:((C=n.value)==null?void 0:C.picture)??void 0});const{categories:s}=Ct();return(i,u)=>{var y,S,T;const $=tt,w=et,P=ft("router-link"),D=at,b=Mt;return m(),k(K,null,[d($,{label:"Budget du mois",color:(y=o(n))==null?void 0:y.color,to:`/groups/${(S=o(n))==null?void 0:S.id}`},null,8,["color","to"]),o(n)?(m(),k("div",Nt,[O("section",Rt,[O("div",At,[d(w),d(w,{label:"Budget initial","initial-budget":""})]),d(o(z),{icon:"pi pi-eye",label:"Récap des dépenses",size:"small",class:L([("getGroupColor"in i?i.getGroupColor:o(H))({color:(T=o(n))==null?void 0:T.color})]),onClick:u[0]||(u[0]=g=>o(t).push(`/groups/${o(a)}/budget/forecast`))},null,8,["class"])]),o(s)&&o(s).length>0?(m(),h(D,{key:0,label:"Budget du mois par catégories"},{header:f(()=>{var g;return[("hasEditPermission"in i?i.hasEditPermission:o(rt))(o(n))?(m(),h(o(z),{key:0,icon:"pi pi-pencil",label:"Modifier les budgets",size:"small",class:L([("getGroupColor"in i?i.getGroupColor:o(H))({color:(g=o(n))==null?void 0:g.color})]),onClick:u[1]||(u[1]=G=>o(t).push(`/groups/${o(a)}/budget/edit`))},null,8,["class"])):I("",!0)]}),default:f(()=>[O("div",Lt,[(m(!0),k(K,null,gt(o(s),(g,G)=>(m(),h(P,{key:G,to:`/groups/${o(a)}/category/${g.id}`,class:L(["flex justify-between rounded-full px-4 py-3",`bg-${g.color}-50 hover:bg-${g.color}-100 text-${g.color}-800`])},{default:f(()=>{var V;return[O("p",null,W(g.label!=="default"?g.label:"Autres"),1),o(c)?(m(),k("p",zt,W(("truncateToTenth"in i?i.truncateToTenth:o(ot))(((V=o(c).find(x=>x.category.id===g.id&&x.monthStart===("formatDateISO"in i?i.formatDateISO:o(Y))(("getCurrentMonthStartDate"in i?i.getCurrentMonthStartDate:o(J))())))==null?void 0:V.amount)??0))+" € ",1)):I("",!0)]}),_:2},1032,["to","class"]))),128))])]),_:1})):(m(),h(o(z),{key:1,size:"small"},{default:f(()=>u[2]||(u[2]=[M("Créer vos budgets",-1)])),_:1,__:[2]})),o(c)&&o(c).length>0?(m(),h(b,{key:2,budgets:o(c),group_id:o(a)},null,8,["budgets","group_id"])):I("",!0)])):I("",!0)],64)}}});export{ae as default};
